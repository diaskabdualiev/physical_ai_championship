# Краткое описание подхода

## Симулятор
MuJoCo 3.3.6 с C++ обёрткой unitree_mujoco. Сцена `scene_room.xml` — комната 4x4м со стенами, ровным полом и красным кубом 0.3x0.3x0.3м на полу. Позиция куба и ориентация робота рандомизируются при каждом запуске.

## Архитектура системы
Система состоит из двух процессов, запускаемых автоматически одной командой:
- **unitree_mujoco** — симулятор MuJoCo с DDS-мостом и модулем автономного поиска
- **g1_ctrl** — контроллер робота G1 (RL-based locomotion policy), запускается как дочерний процесс через `fork()+exec()`

Обмен данными — через DDS (unitree_sdk2): симулятор публикует `LowState` (сенсоры, джойстик), контроллер подписывается и публикует `LowCmd` (моменты на моторы).

## Датчики
- **RGB-камера** (`head_cam`) — установлена на голове робота, рендерится offscreen с разрешением 320x240 каждые 50 шагов симуляции
- **Depth buffer** — считывается одновременно с RGB для оценки расстояния до объекта
- **LiDAR** (`rangefinder`) — сенсор на голове, направленный вперёд
- **IMU** — кватернион, гироскоп, акселерометр на торсе и вторичный IMU

## Алгоритм поиска и приближения
Модуль `AutoSearch` реализует конечный автомат с двумя режимами:

1. **SEARCHING** — куб не обнаружен. Робот вращается на месте (yaw rate = max) до обнаружения красного объекта в кадре.

2. **APPROACHING** — куб обнаружен:
   - **Центрирование**: если куб не по центру кадра (|offset| > 15%), робот поворачивается в сторону куба
   - **Движение вперёд**: если куб отцентрирован, робот идёт прямо на максимальной скорости
   - **Остановка**: когда расстояние по depth buffer <= 0.5м, робот останавливается

## Визуальное обнаружение
Классическое компьютерное зрение (OpenCV):
1. Конвертация RGB -> HSV
2. Пороговая фильтрация красного цвета (два диапазона Hue для обработки wrap-around)
3. Морфологическая очистка (open + close)
4. Поиск контуров, выбор наибольшего по площади
5. Bounding box -> центр объекта -> offset от центра кадра

Координаты объекта не зашиты — алгоритм полагается исключительно на визуальное обнаружение в реальном времени.

## Автоматический запуск
Последовательность boot без участия человека:
1. Elastic band удерживает робота в воздухе
2. Постепенное опускание (увеличение длины пружины)
3. Программная инъекция команд FixStand (LT+Up) и Velocity (RB+X) через DDS
4. Отключение пружины после стабилизации
5. Автоматический запуск поиска
